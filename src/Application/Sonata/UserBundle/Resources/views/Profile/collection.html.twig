{% extends 'ApplicationSonataUserBundle:Profile:base.html.twig' %}

{% block optional_menu %}
<li class="nav-header">{{ 'countries.list'|trans }}</li>

{% for country in countries %}
	{% set _name = macros.name(country) %}

	<li{% if country.name == current.name %} class="active"{% endif %} data-action="popover" title="{{ _name }}" data-content="{% include 'EuroCoinBundle:Country:country_data.html.twig' with { country: country } %}">
		<a href="{{ path('show_user_collection', { country_name: _name, country_id: country.id, user_id: user.id }) }}">
			<i class="icon-chevron-right"></i> {{ _name }}
		</a>
	</li>
{% endfor %}

<li class="divider"></li>
{% endblock %}

{% block content %}
{% set header %}
<tr>
	<th>&nbsp;</th>
	{% for value in all_values %}
	<th>{{ macros.value(value) }}</th>
	{% endfor %}
</tr>
{% endset %}

{% set empty_cell %}
<td style="text-align: center;">{{ 'coin.no_mintage'|trans }}</td>
{% endset %}

<table class="table table-bordered table-condensed table-hover table-striped">
<tbody>
	{{ header }}

	{% for year, values in coins %}
		{% if loop.index0 > 0 and loop.index0 % 5 == 0 %}
			{{ header }}
		{% endif %}

		<tr>
			{% set has_year = false %}
			{% for value in all_values if values[value] is defined and not has_year %}
				{% set has_year = true %}

				<td>{{ macros.year(values[value].year) }}</td>
			{% endfor %}

			{% for value in all_values %}
				{% if values[value] is defined %}
					{% set coin = values[value] %}

					{% if app.user %}
						{% set has_coin = uc[coin.id] is defined %}
					{% endif %}

					{% set quantity = has_coin ? uc[coin.id].quantity : 0 %}

					<td>
						<div class="btn-toolbar" data-coin="{{ coin.id }}">
							<div class="btn-group">
								<button class="btn btn-mini btn-info" title="{{ 'coin.information'|trans }}" data-action="query-coin-info" data-loading-text="?">?</button>
								<button class="btn btn-mini disabled" disabled="disabled" title="{{ 'coin.self_quantity'|trans }}">{{ quantity|number_format_duration }}</button>
							</div>
						</div>
					</td>
				{% else %}
					{{ empty_cell }}
				{% endif %}
			{% endfor %}
		</tr>
	{% endfor %}
</tbody>
</table>
{% endblock %}
