{% extends "::base.html.twig" %}

{% block title %}{{ 'news'|trans }}{% endblock %}

{% block body %}
<h2 class="page-header">{{ block('title') }}</h2>

<div class="row-fluid">
	{% for post in posts %}
			{% if loop.index0 > 0 and loop.index0 % 3 == 0 %}
				</div>
				<div class="row-fluid">
			{% endif %}

		<div class="span4">
			<h3><a href="{{ url('sonata_news_view', { permalink: sonata_news_permalink(post) }) }}">{{ post.title }}</a></h3>

			<p>{{ post.abstract|format_text('markdown')|raw }}</p>
			<p>
				<span class="muted">{{ 'news.posted_by_on'|trans({ '%author%': post.author, '%date%': post.publicationDateStart|format_datetime, '%path%': path('show_profile', { id: post.author.id }) })|raw }}</span>
			</p>
		</div>
	{% else %}
		<div class="alert">{{ 'news.none'|trans }}</div>
	{% endfor %}
</div>

<h3 class="page-header">{{ 'stats'|trans }}</h3>

<div class="row-fluid">
	<div class="span4 well" style="padding: 8px 0;">
		<ul class="nav nav-list">
			<li class="nav-header">{{ 'stats.top_countries'|trans }}</li>

			{% for country in stats.top_countries %}
				{% set country, total = country[0].country, country.total %}
				{% set name = macros.name(country) %}

				<li><a class="clearfix" href="{{ path('coin_collection1', { id: country.id, country: name }) }}">
					<span class="pull-left">
						<img alt="{{ name }}" src="{% path country.flag, 'mini' %}" title="{{ name }}" />
						{{ name }}
					</span>
					<span class="pull-right">{{ 'coins'|transchoice(total, { '%total%': total|number_format }) }}</span>
				</a></li>
			{% else %}
				<li>{{ 'no_data'|trans }}</li>
			{% endfor %}
		</ul>
	</div>

	<div class="span4 well" style="padding: 8px 0;">
		<ul class="nav nav-list">
			<li class="nav-header">{{ 'stats.biggest_collections'|trans }}</li>

			{% for user in stats.biggest_collections %}
				{% set user, total, total_uniques = user[0].user, user.total, user.total_uniques %}

				<li><a class="clearfix" href="{{ path('show_user_collection1', { user_id: user.id }) }}">
					<span class="pull-left">
						<img alt="{{ user.username }}" src="{{ gravatar(user.email, 16) }}" title="{{ user.username }}" />
						{{ user.username }}
					</span>
					<span class="pull-right">
						{{ 'coins'|transchoice(total, { '%total%': total|number_format }) }}
						({{ 'coins.differents'|transchoice(total_uniques, { '%total%': total_uniques|number_format }) }})
					</span>
				</a></li>
			{% else %}
				<li>{{ 'no_data'|trans }}</li>
			{% endfor %}
		</ul>
	</div>

	<div class="span4 well" style="padding: 8px 0;">
		<ul class="nav nav-list">
			<li class="nav-header">{{ 'stats.most_valued_collections'|trans }}</li>

			{% for user in stats.most_valued_collections %}
				{% set user, total = user[0].user, user.total %}

				<li><a class="clearfix" href="{{ path('show_user_collection1', { user_id: user.id }) }}">
					<span class="pull-left">
						<img alt="{{ user.username }}" src="{{ gravatar(user.email, 16) }}" title="{{ user.username }}" />
						{{ user.username }}
					</span>
					<span class="pull-right">{{ macros.value(total) }}</span>
				</a></li>
			{% else %}
				<li>{{ 'no_data'|trans }}</li>
			{% endfor %}
		</ul>
	</div>
</div>
{% endblock %}
