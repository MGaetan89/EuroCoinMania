{% extends '::base.html.twig' %}

{% block body %}
<h2 class="page-header">
	{% if all %}
		{{ 'exchange.list_all'|trans }}
	{% else %}
		{{ 'exchange.list_pending'|trans }}
	{% endif %}
</h2>

<div class="row-fluid">
	<div class="span2">
		<div class="dropdown">
			<ul class="dropdown-menu" style="display: block;">
				<li class="nav-header">{{ 'exchange.actions'|trans }}</li>
				<li>
					<a href="{{ path('exchange_choose_user') }}">
						<i class="icon-chevron-right"></i> 
						{{ 'exchange.new'|trans }}
					</a>
				</li>
				<li{% if not all %} class="active"{% endif %}>
					<a href="{{ path('exchange_list') }}">
						<i class="icon-chevron-right"></i> 
						{{ 'exchanges.pending'|trans }}
					</a>
				</li>
				<li{% if all %} class="active"{% endif %}>
					<a href="{{ path('exchange_list_all') }}">
						<i class="icon-chevron-right"></i> 
						{{ 'exchanges.all'|trans }}
					</a>
				</li>
			</ul>
		</div>
	</div>
	<div class="span10">
		<table class="table table-bordered table-hover table-striped">
		<thead>
			<tr>
				<th>{{ 'exchange.direction'|trans }}</th>
				<th>{{ 'exchange.proposed_on'|trans }}</th>
				<th>{{ 'exchange.coins_requested'|trans }}</th>
				<th>{{ 'exchange.coins_suggested'|trans }}</th>

				{% if all %}
					<th>{{ 'exchange.status'|trans }}</th>
				{% else %}
					<th>{{ 'exchange.actions'|trans }}</th>
				{% endif %}
			</tr>
		</thead>
		<tbody>
		{% set row_classes = ['info', 'success', 'warning', 'error'] %}
		{% for share in shares %}
			<tr class="{{ row_classes[share.status - 1] }}">
				<td>
					{% if share.fromuser.id == app.user.id %}<strong>{% endif %}
						{{ share.fromuser.username }}
					{% if share.fromuser.id == app.user.id %}</strong>{% endif %}

					&rarr;

					{% if share.touser.id == app.user.id %}<strong>{% endif %}
						{{ share.touser.username }}
					{% if share.touser.id == app.user.id %}</strong>{% endif %}
				</td>
				<td>{{ share.date|format_datetime }}</td>
				<td>
					<ul>
						{% for coin in coins[share.id]['requested'] %}
							<li>{{ macros.coin(coin) }}</li>
						{% endfor %}
					</ul>
				</td>
				<td>
					<ul>
						{% for coin in coins[share.id]['suggested'] %}
							<li>{{ macros.coin(coin) }}</li>
						{% endfor %}
					</ul>
				</td>

				{% if all %}
					<td>{{ ('exchange.status' ~ share.status)|trans }}</td>
				{% else %}
					<td>
						<div class="btn-group">
							{% if share.fromuser.id == app.user.id %}
								<a class="btn btn-small btn-warning" href="{{ path('exchange_cancel', { id: share.id }) }}" title="{{ 'exchange.cancel'|trans }}"><i class="icon-minus-sign"></i></a>
							{% else %}
								<a class="btn btn-small btn-success" title="{{ 'exchange.accept'|trans }}"><i class="icon-ok"></i></a>
								<a class="btn btn-small btn-danger" title="{{ 'exchange.refuse'|trans }}"><i class="icon-remove"></i></a>
							{% endif %}
						</div>
					</td>
				{% endif %}
			</tr>
		{% endfor %}
		</tbody>
		</table>
	</div>
</div>
{% endblock %}
