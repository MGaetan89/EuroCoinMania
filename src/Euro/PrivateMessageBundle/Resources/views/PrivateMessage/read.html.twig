{% extends '::base.html.twig' %}

{% block title %}{{ messages[messages|length - 1].title }}{% endblock %}

{% block body %}
<div class="page-header">
	<h1>
		{{ block('title') }}

		<small>
			{% if messages[0].isopen %}
				<a data-toggle="collapse" data-target="#answer_form">{{ 'pm.answer'|trans }}</a>

				<div class="pull-right">
					{% set close_text = 'pm.close' %}
					{% if messages[0].share and messages[0].share.fromusercoin.user.id != app.user.id %}
						{% set close_text = 'pm.reject' %}

						<a class="btn btn-success" href="{{ path('pm_close', { id: messages[0].conversation }) }}">
							<i class="icon icon-white icon-ok"></i> {{ 'pm.accept'|trans }}
						</a>
					{% endif %}

					<a class="btn btn-danger" href="{{ path('pm_close', { id: messages[0].conversation }) }}">
						<i class="icon icon-white icon-remove"></i> {{ close_text|trans }}
					</a>
				</div>
			{% else %}
				<em>{{ 'pm.closed'|trans }}</em>
			{% endif %}
		</smal>
	</h1>
</div>

<div class="collapse" id="answer_form">
	{% include "EuroPrivateMessageBundle:PrivateMessage:form.html.twig" with {
		mode: 'answer',
		path: path('pm_read', { id: messages[0].conversation })
	} %}
</div>

{% for message in messages %}
	<div class="well">
		<div class="row-fluid">
			<div class="span2">
				<strong><a href="{{ path('user_view', { id: message.fromuser.id }) }}">{{ message.fromuser.username }}</a></strong>,<br />
				{{ 'pm.on'|trans }} {{ message.postdate|localizeddate }}
			</div>

			<div class="span10">
				{% if message.title %}
					<div class="page-header">
						<h3>{{ message.title }}</h3>
					</div>
				{% endif %}

				{{ message.text|markdown|nl2br }}
			</div>
		</div>
	</div>
{% endfor %}

<script src="{{ asset('bundles/europrivatemessage/js/pm.js') }}" type="text/javascript"></script>
{% endblock %}
