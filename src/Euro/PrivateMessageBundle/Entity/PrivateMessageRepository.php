<?php

namespace Euro\PrivateMessageBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * PrivateMessageRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PrivateMessageRepository extends EntityRepository {

	public function getNewMessageCount($user) {
		$queryBuiler = $this->createQueryBuilder('pm');
		$expr = $queryBuiler->expr();

		return (int) $queryBuiler
						->select($expr->count('DISTINCT pm.conversation'))
						->where($expr->eq('pm.to_user', ':user'))
						->andWhere($expr->eq('pm.is_read', '0'))
						->setParameter('user', $user)
						->getQuery()
						->getSingleScalarResult();
	}

}
